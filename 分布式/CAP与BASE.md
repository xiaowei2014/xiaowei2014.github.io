# CAP与BASE

https://chenmingyu.top/distributed-transaction/

### CAP理论

CAP：Consistency Acailability Partition tolerance 的简写

- Consistency：一致性

  对某个客户端来说，读操作能够返回最新的写操作结果

- Acailability：可用性

  非故障节点在合理的时间内返回合理的响应

- Partition tolerance：分区容错性

  当出现网络分区后，系统能够继续提供服务 *你知道什么是网络分区吗 ~~*

因为分布式系统中系统肯定部署在多台机器上，无法保证网络做到100%的可靠，所以网络分区一定存在，即P一定存在；

在出现网络分区后，就出现了可用性和一致性的问题，我们必须要在这两者之间进行取舍，因此就有了两种架构：CP架构，AP架构；

#### CP架构

当网络分区出现后，为了保证一致性，就必须拒接请求，否则无法保证一致性

![img](CAP1.png)

1. 当没有出网络分区时，系统A与系统B的数据一致，X=1
2. 将系统A的X修改为2，X=2
3. 当出现网络分区后，系统A与系统B之间的数据同步数据失败，系统B的X=1
4. 当客户端请求系统B时，为了保证一致性，此时系统B应拒绝服务请求，返回错误码或错误信息

上面这种方式就违背了可用性的要求，只满足一致性和分区容错，即CP

CAP理论是忽略网络延迟，从系统A同步数据到系统B的网络延迟是忽略的

CP架构保证了客户端在获取数据时一定是最近的写操作，或者获取到异常信息，绝不会出现数据不一致的情况

#### AP架构

当网络分区出现后，为了保证可用性，系统B可以返回旧值，保证系统的可用性

![img](CAP2.png)

1. 当没有出网络分区时，系统A与系统B的数据一致，X=1
2. 将系统A的X修改为2，X=2
3. 当出现网络分区后，系统A与系统B之间的数据同步数据失败，系统B的X=1
4. 当客户端请求系统B时，为了保证可用性，此时系统B应返回旧值，X=1

上面这种方式就违背了一致性的要求，只满足可用性和分区容错，即AP

CP架构保证了客户端在获取数据时无论返回的是最新值还是旧值，系统一定是可用的

**CAP理论关注粒度是数据，而不是整体系统设计的策略**

### BASE理论

 BASE理论指的是基本可用 Basically Available，软状态 Soft Stat，最终一致性 Eventual Consistency，核心思想是即便无法做到强一致性，但应该可以有采用适合的方式保证最终一致性

BASE：Basically Available Soft Stat Eventual Consistency的简写

- BA：Basically Available 基本可用

  分布式系统在出现故障的时候，允许损失部分可用性，即保证核心可用

- S：Soft Stat 软状态

  允许系统存在中间状态，而该中间状态不会影响系统整体可用性

- E：Consistency 最终一致性

  系统中的所有数据副本经过一定时间后，最终能够达到一致的状态

BASE理论本质上是对CAP理论的延伸，是对 CAP 中 AP 方案的一个补充